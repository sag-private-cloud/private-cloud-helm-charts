<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv='cache-control' content='no-cache'> 
    <meta http-equiv='expires' content='0'> 
    <meta http-equiv='pragma' content='no-cache'>
    <title>webMethods Helm Charts Repository</title>
    <link rel="stylesheet" type="text/css" href="resources/static/css/style.css"/>
    <link rel="icon" href="resources/static/img/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" type="text/css" href="wm_node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="wm_node_modules/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.css" />
    <link rel="stylesheet" type="text/css" href="wm_node_modules/@softwareag/dlt-components/css/delite.min.css"/>
    <link rel="stylesheet" type="text/css" href="wm_node_modules/@softwareag/dlt-fonts/roboto.css"/>
    <link rel="stylesheet" type="text/css" href="wm_node_modules/@softwareag/dlt-icons/Font/css/dlt-icons-font.css"/>
    <link rel="stylesheet" type="text/css" href="wm_node_modules/@softwareag/dlt-tokens/web/css/dlt-tokens.css">
</head>

<body class="d-flex flex-column min-vh-100">
    <div class="container col-12 mr-0 ml-0 pl-0 pr-0">
        <div class="row no-gutters">
            <div class="col-12">
                
                <div class="header-wrap">
                    <header class="container col-12 no-margin no-padding main-head">
                        <a class="brand">
                            <img src="resources/static/img/logo.svg" alt="Logo">
                        </a>
                        <div style="margin-left: 50px;">webMethods Helm Charts Repository</div>
                    </header>
                </div>
            </div>
        </div>

        <div class="no-gutters">
            <div class="dlt-card w-100 no-gutters large-logo" style="margin-top: 15px;">
                <p>
                    To use the webMethods charts, add this repository to your Helm configuration:<br><br>
                    <b>helm repo add webMethods https://charts.webmethods.io && helm repo update</b>
                </p>
                <p>
                    Once added, you can search for and install webMethods charts using the Helm CLI.
                </p>
            </div>

            <div class="row mt-4 mx-2">
            </div>

            <div style="text-align: center; margin-top: 10px;">
                <h4>webMethods Charts</h4>
            </div>

            <div id="helm-charts-body" class="m-2 m-md-4" style="margin-top: 0px !important">
                
            </div>
        </div>

    </div>

    <script src="resources/static/js/helm-copy.js"></script>
    <script src="wm_node_modules/jquery/dist/jquery.min.js"></script>
    <script src="wm_node_modules/js-yaml/dist/js-yaml.js"></script>
    <script src="wm_node_modules/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js" type="text/javascript"></script>
    <script src="wm_node_modules/@softwareag/dlt-components/js/delite.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetch('index.yaml')
            .then(response => response.text())
            .then(yamlText => {
                // Parse YAML into JSON
                const yamlObject = jsyaml.load(yamlText);

                // Get the entries object
                const entries = yamlObject.entries;

                // Get the table body element to append the table rows
                const helmChartBody = document.getElementById('helm-charts-body');

                // Iterate through each entry
                Object.keys(entries).forEach((entryKey,i) => {
                    const entryList = entries[entryKey]; // Get all entries for the same chart name

                    // Iterate through each entry for the same chart name
                    entryList.forEach(entry => {
                        let currentHelmChartDiv = document.createElement('div');

                        // Populate a div with name, version, appVersion, and description
                        currentHelmChartDiv.innerHTML = `
                            <div style="display: flex; width: 40%;">
                                <span class="dlt-list-item__text">
                                    <span class="dlt-list-item__primary-text"></span>
                                    <span class="dlt-list-item__secondary-text"></span>
                                    <span class="dlt-list-item__secondary-text"></span>
                                </span>
                            </div>
                            <div class="dlt-input-group">
                                <span class="helm-chart-description dlt-list-item__secondary-text" style="text-align: center !important"></span>
                            </div>

                            <div class="dlt-input-group">
                                <div class="dlt-form-item input">
                                    <div class="dlt-form-group" style="justify-content: flex-end">
                                        <div class="helm-install-command-label dlt-text-input label-secondary"></div>
                                    </div>
                                </div>
                                <button class="helm-install-command-icon dlt-button dlt-button-secondary" type="button" onclick="copyHelmInstallCommandToClipboard(this.getAttribute('helm-chart-name')); showCopiedIcon(this.getAttribute('id'))">
                                    <i class="dlt-icon-copy dlt-icon"></i>
                                </button>
                            </div>
                        `;

                        // Add the attributes to the div
                        currentHelmChartDiv.setAttribute('class', 'helm-chart dlt-card w-100 p-2 tag-card');
                        currentHelmChartDiv.setAttribute('helm-chart-name', entry.name);
                        currentHelmChartDiv.setAttribute('helm-chart-version', entry.version);
                        currentHelmChartDiv.setAttribute('application-version', entry.appVersion);
                        currentHelmChartDiv.setAttribute('helm-chart-description', entry.description);


                        helmChartSpan = currentHelmChartDiv.querySelector('div span');
                        helmChartSpan.querySelectorAll('span')[0].innerHTML = entry.name.charAt(0).toUpperCase() + entry.name.slice(1);
                        helmChartSpan.querySelectorAll('span')[1].innerHTML = `Chart Version: ${entry.version}`;
                        helmChartSpan.querySelectorAll('span')[2].innerHTML = `Application Version: ${entry.appVersion}`;

                        currentHelmChartDiv.querySelector('.helm-chart-description').innerHTML = entry.description

                        currentHelmChartDiv.querySelector('.helm-install-command-label').id = `helm-install-command-label-${i}`;
                        currentHelmChartDiv.querySelector('.helm-install-command-icon').id = `helm-install-command-icon-${i}`;
                        currentHelmChartDiv.querySelector('.helm-install-command-icon').setAttribute('helm-chart-name', entry.name);
                        
                        updateHelmInstallCommand(currentHelmChartDiv, entry.name);

                        helmChartBody.appendChild(currentHelmChartDiv);
                    });
                });
            })
            .catch(error => console.error('Error fetching YAML:', error));
        });
    </script>
</body>
</html>
